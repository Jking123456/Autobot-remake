const axios = require("axios");

module.exports.config = {
  name: "artist",
  version: "1.0.1",
  hasPrefix: true,
  permission: 0,
  credits: "Homer Rebatis + ChatGPT",
  description: "Fetch artist profile or artwork using userid.",
  commandCategory: "art",
  usages: "artist [userid]",
  cooldowns: 3,
};

module.exports.run = async function ({ api, event, args }) {
  const userId = args.join(" ").trim();

  if (!userId) {
    return api.sendMessage(
      "ğŸ­ Please provide a user ID.\n\nUsage: artist [userid]",
      event.threadID,
      event.messageID
    );
  }

  try {
    const res = await axios.get(`https://api-canvass.vercel.app/artist?userid=${encodeURIComponent(userId)}`, {
      responseType: "text"
    });

    const rawText = res.data?.trim();
    console.log("[API RESPONSE]", rawText);

    // If it's not a valid image URL or doesn't look right
    if (!rawText || !rawText.startsWith("http")) {
      return api.sendMessage(
        "âŒ No artist data found or invalid API response.",
        event.threadID,
        event.messageID
      );
    }

    // Dummy profile info â€” since no JSON is returned
    const info = `ğŸ¨ Artist Profile:

ğŸ‘¤ Name: Unknown
ğŸ“ Bio: Not available.
ğŸ–¼ï¸ Here's the artist's featured work:`;

    const img = await axios.get(rawText, { responseType: "stream" });

    return api.sendMessage(
      {
        body: info,
        attachment: img.data
      },
      event.threadID,
      event.messageID
    );
  } catch (err) {
    console.error("[ARTIST COMMAND ERROR]", err.message || err);
    return api.sendMessage(
      "âš ï¸ Failed to fetch artist info. Please try again later.",
      event.threadID,
      event.messageID
    );
  }
};
